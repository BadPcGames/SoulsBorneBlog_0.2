@using WebApplication1.DbModels
@model IEnumerable<Blog>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Фиксированный макет с прокручиваемым центральным блоком</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

    <style>
        #fileInput {
            display: none;
        }

        #image {
            cursor: pointer;
            width: 200px; 
            height: 200px; 
            border: 2px solid #ccc; 
            border-radius: 8px; 
        }
    </style>
</head>
<body>
    <h2>Список пользователей</h2>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Имя</th>
                <th>Email</th>
                <th>Бан до</th>
                <th>Блокировка</th>
            </tr>
        </thead>
        <tbody id="usersTableBody"></tbody>
    </table>

    <script>
        function loadUsers() {
            $.ajax({
                url: '@Url.Action("GetUsers", "Moder")',
                method: 'GET',
                success: function (users) {
                    let tableBody = $('#usersTableBody');
                    tableBody.empty();
                    users.forEach(user => {
                        let row = `<tr>
                                    <td>${user.id}</td>
                                    <td>${user.name}</td>
                                    <td>${user.email}</td>                                  
                                    <td>${user.banTime ? new Date(user.banTime).toLocaleString() : 'Не заблокирован'}</td>
                                    <td>
                                        <input type="number" min="1" max="365" value="1" id="banDays-${user.id}" /> дней
                                        <button onclick="banUser(${user.id})">Забанить</button>
                                    </td>
                                    <td>
                                        <button onclick="deBanUser(${user.id})">Розбанити</button>
                                    </td>
                                </tr>`;
                        tableBody.append(row);
                    });
                }
            });
        }

        function banUser(userId) {
            let days = $(`#banDays-${userId}`).val();

            $.ajax({
                url: '@Url.Action("TemporaryBan", "Moder")',
                method: 'POST',
                data: 
                    { userId: userId, 
                    banTime: days },
                success: function () {
                    alert('Пользователь забанен!');
                    loadUsers();
                }
            });
        }

        function deBanUser(userId) {
            $.ajax({
                url: '@Url.Action("DeleteBan", "Moder")',
                method: 'POST',
                data:
                {
                    userId: userId,
                },
                success: function () {
                    alert('Пользователь разбанен!');
                    loadUsers();
                }
            });
        }

        $(document).ready(function () {
            loadUsers();
        });
    </script>
</body>


