@using WebApplication1.DbModels

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Фиксированный макет с прокручиваемым центральным блоком</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        #image-preview {
            cursor: pointer;
            width: 200px;
            height: 200px;
            border: 2px solid #ccc;
            border-radius: 8px;
            object-fit: cover;
        }
        .banner-container {
            display: inline-block;
            text-align: center;
            margin: 10px;
        }

        .banner-image {
            width: 200px;
            height: 200px;
            border: 5px solid gray;
            display: block;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .banner-image.selected {
            border: 15px solid green;
        }

        .banner-button {
            margin: 5px;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .delete-button {
            background-color: #e74c3c;
            color: white;
            border: none;
        }

        .select-button {
            background-color: #2ecc71;
            color: white;
            border: none;
        }

        .banner-button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <a asp-action="Index" asp-controller="Admin">Назад</a>
    <br>

    <form id="upload-form" enctype="multipart/form-data" class="mb-4">
        <div class="mb-2">
            <input type="file" name="image" id="image" accept="image/*" required>
        </div>
        <div class="form-check mb-2">
            <input type="checkbox" class="form-check-input" id="isSelected" name="isSelected">
            <label class="form-check-label" for="isSelected">Выбран</label>
        </div>
        <button type="submit" class="btn btn-primary">Додати банер</button>
    </form>


    <div id="banner-list" class="d-flex flex-wrap"></div>

</body>

<script>
    $(document).ready(function () {
        getBaners(); 
    });
    $('#upload-form').on('submit', function (e) {
            e.preventDefault();
            const formData = new FormData();
            formData.append('image', $('#image')[0].files[0]);
            formData.append('isSelected', $('#isSelected').is(':checked'));

            $.ajax({
                url: '/Admin/AddBaner',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    alert(response.message);
                    $('#upload-form')[0].reset();
                    getBaners();
                },
                error: function () {
                    alert('Ошибка при добавлении банера');
                }
            });
    });  

    function setActiveBanner(id){
        $.ajax({
                url: '/Admin/SelectBaner',
                type: 'POST',
                data: {
                    id:id
                },
                success: function (response) {
                    alert(response.message);
                    getBaners();
                },
                error: function () {
                    alert('Помилка при обирані банера');
                }
            });
    }

    function deleteBanner(id){
             $.ajax({
                url: '/Admin/DeleteBaner',
                type: 'POST',
                data: {
                    id:id
                },
                success: function (response) {
                    alert(response.message);
                    getBaners();
                },
                error: function () {
                    alert('Помилка при видалені');
                }
            });
    }


    function getBaners() {
        $.ajax({
            url: '/Admin/GetBanners',
            method: 'GET',
            success: function (data) {
                if (data.success && data.message) {
                    alert(data.message);
                    return;
                }

                $('#banner-list').empty();

                data.forEach(banner => {
                const container = $('<div>').addClass('banner-container');

                const img = $('<img>')
                    .attr('src', 'data:image/png;base64,' + banner.image)
                    .addClass(banner.selected ? 'banner-image selected' : 'banner-image');

                const deleteBtn = $('<button>')
                    .text('Видалити')
                    .addClass('banner-button delete-button')
                    .on('click', function () {
                        deleteBanner(banner.id);
                    });

                const selectBtn = $('<button>')
                    .text('Обрати')
                    .addClass('banner-button select-button')
                    .on('click', function () {
                        setActiveBanner(banner.id);
                    });

                container.append(img, deleteBtn, selectBtn);
                $('#banner-list').append(container);
            });
            },
            error: function (err) {
                console.error('Ошибка при получении баннеров', err);
            }
        });
    }
</script>
